{% extends 'layouts/admin-layout.html' %}

{% load static %}

{% block cssFile %}
<style>
.message.sent {
    align-self: end;
}
.message.received {
    align-self: start;
}
.chat {
    cursor: pointer;
}
.chat:hover {
    backdrop-filter: brightness(0.85);
}
</style>    
{% endblock cssFile %}

{% block title %}
    Chat
{% endblock title %}

{% block content %}
    <div class="container-fluid h-100">
        <div class="row h-100">
            <div class="col-3">
                <div class="border-end h-100 py-3 px-1">
                    <div class="border-bottom py-2">
                        <h5>Customers</h5>
                    </div>
                    <div class="d-flex flex-column">

                        <script src="{% static 'js/chatter.js' %}"></script>
                        {% for c in chaters %}
                            <div class="border-bottom d-flex py-2 px-2 chat" data-customer-id="{{c.id}}">
                                <div class="d-flex justify-content-center align-items-center" style="width: 50px; height: 50px; border-radius: 50%;">
                                    <img style="width: 100%; height: 100%; object-fit: cover;" 
                                    
                                    src="{%if c.accountdetail.photo %}{{c.accountdetail.photo.url}}{% else %}{% static 'images/profile.webp' %}{% endif %}"
                                    
                                     alt="" srcset="">
                                </div>
                                <div class="flex-fill ms-3">
                                    <div class="fs-6">{{c.name}}</div>
                                    <span class="df-fs-sm text-muted">{{c.email}}</span>
                                </div>
                            </div>
                        {% endfor %}
                            

                    </div>
                </div>
            </div>
            <div class="col-8">
                
                {% if customer %}
                    <div class="d-flex flex-column h-100">
                        <div class="p-2 d-flex border-bottom">
                            <div class="d-flex justify-content-center align-items-center" style="width: 50px; height: 50px; border-radius: 50%;">
                                    <img style="width: 100%; height: 100%; object-fit: cover;" 
                                    
                                    src="{%if c.accountdetail.photo %}{{c.accountdetail.photo.url}}{% else %}{% static 'images/profile.webp' %}{% endif %}"
                                    
                                     alt="" srcset="">
                            </div>
                            <div class="flex-fill ms-3">
                                <div class="fs-6">{{customer.accountdetail.name}}</div>
                                <span class="df-fs-sm text-muted">{{customer.email}}</span>
                            </div>

                        </div>
                        <div class="d-flex flex-column flex-fill">
                            <div id="chatLog" data-customer-id="{{customer.id}}" data-user-type="admin" class="flex-fill">

                            </div>
                            <div class="d-flex pb-5 mb-3">
                                <textarea id="chatInput" row="1" type="text" class="form-control rounded-pill px-4"></textarea>
                                <button id="chatSendBtn" class="btn df-btn-glass-blue rounded-pill ms-3">Send</button>
                            </div>
                            <script src="{% static 'js/chat.js' %}"></script>
                        </div>
                    </div>
                {% else %}
                    <div class="h-100 d-flex justify-content-center align-items-center">
                        <h5>Select one customer to chat.</h5>
                    </div>

                {% endif %}
                    

            </div>
        </div>
    </div>

{% endblock content %}