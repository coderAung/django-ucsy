{% extends 'layouts/setting-layout.html' %}
{% block cssFile%}
<style>
    :root {
        --custom-primary: #198754;
    }
    .btn-custom-primary {
        background-color: var(--custom-primary);
        color: white;
    }
    .btn-custom-primary:hover {
        background-color: #146c43;
        color: white;
    }
    .btn-outline-custom-primary {
        color: var(--custom-primary);
        border-color: var(--custom-primary);
    }
    .btn-outline-custom-primary:hover {
        background-color: var(--custom-primary);
        color: white;
    }
    .form-control-custom {
        border-color: #ced4da;
    }
    .form-control-custom:focus {
        border-color: var(--custom-primary);
        box-shadow: 0 0 0 0.25rem rgba(25, 135, 84, 0.25);
    }
</style>

{%endblock cssFile%}
{% block jsFile %}
<script>
document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById("passwordForm");
    const messageContainer = document.getElementById("message-container");

    function showMessage(message, type) {
        messageContainer.innerHTML = `
            <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `;
    }

    form.addEventListener("submit", function(e) {
        e.preventDefault(); // stop normal form submission
        
        messageContainer.innerHTML = ''; // Clear previous messages

        const formData = new FormData(form);

        fetch(form.action, {
            method: "POST",
            body: formData,
            headers: {
                "X-CSRFToken": formData.get("csrfmiddlewaretoken")
            }
        })
        .then(response => response.json().then(data => {
            if (response.ok) {
                showMessage(data.success, "success");
                form.reset();
                setTimeout(() => {
                    window.location.href = data.redirect;
                }, 1500); // Redirect after a delay
            } else {
                showMessage(data.error, "danger");
            }
        }))
        .catch(error => {
            console.error("Error:", error);
            showMessage("An unexpected error occurred. Please try again.", "danger");
        });
    });
});
</script>
{% endblock jsFile %}

{% block setting_content %}
<div id="message-container" class="mb-4"></div>

<h4 class="fw-bold mb-4">Change your Password</h4>
<form id="passwordForm" method="POST" action="{% url 'settings_account_password_change' %}">
    {% csrf_token %}
    <div class="row mb-3">
        <div class="col-lg-9">
            <label for="oldPasswordInput" class="form-label">Current Password</label>
            <input type="password" class="form-control form-control-custom" id="oldPasswordInput" name="old_password" placeholder="Enter current password" required>
        </div>
    </div>
    <div class="row mb-3">
        <div class="col-lg-9">
            <label for="newPasswordInput" class="form-label">New Password</label>
            <input type="password" class="form-control form-control-custom" id="newPasswordInput" name="new_password1" placeholder="Enter new password" required>
            </div>
    </div>
    <div class="row mb-4">
        <div class="col-lg-9">
            <label for="confirmPasswordInput" class="form-label">Confirm New Password</label>
            <input type="password" class="form-control form-control-custom" id="confirmPasswordInput" name="new_password2" placeholder="Confirm new password" required>
        </div>
    </div>
    <button type="submit" class="btn btn-custom-primary">Save Password</button>
</form>

{% endblock %}
